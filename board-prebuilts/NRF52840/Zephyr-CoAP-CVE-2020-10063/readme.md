
# Zephyr CoAP Server App

> **board**: NRF52840

> **host environment**: x86-64, Ubuntu 19.10

## Flash the image on the board

This prebuilt vulnerable CoAP server application of Zephyr OS is integrated with RapidPatch. 

Please flash the `zephyr.bin` image to your NRF52840 board first, using JTAG SWD or any other available debug interface.


## Evaluation

We use a CoAP client on the host machine to evaluate the performance of Zephyr CoAP Server App on NRF52840 board.

So please first establish a wired or wireless connection between the board and your PC (host machine).

* Notice that this image has enabled a USB-to-Ethernet driver. So if your board has a USB interface, you can establish an Ethernet connection between the board and your host machine directly with a USB cable.

Once you have flashed your board, you can estabish a serial connection with your board utilizing the USB-to-UART interface and a terminal tool (e.g., PuTTY, cutecom). As the terminal tool connects successfully, reset the board, and then you can see the simple cli we provide with RapidPatch. 

```
[23:24:31:997] ***** Booting Zephyr OS zephyr-v1.14.1 *****␍␊
[23:24:34:999] IoTPatch Cli Usage: run [idx] | trigger [cve] | patch [cve] | vm [vid]␍␊
[23:24:35:005] run 0: Test FPB breakpoint add␍␊
[23:24:35:011] run 1: Test FPB patch trigger␍␊
[23:24:35:018] run 2: Clear all bpkt and patch␍␊
[23:24:35:018] run 3: Run eva test␍␊
[23:24:35:018] run 4: Start patch service␍␊
[23:24:35:026] run 5: Start testing fixed patch point␍␊
```

To minimize the evaluation efforts, we have embedded the dynamic-JIT eBPF patch code for CVE-2020-10063 in the prebuilt image. And you can trigger the patch process (install and enable the patch) by inputing to the cli:

```
patch 1
```

And you can rewind the patch through inputing (or just reseting the board):

```
run 2
```

The CoAP client on the host machine sends GET requests to the CoAP server and the request-response latencies are recorded in *out.txt*.

- Requests are sent sequentially.
- Latencies are recorded as microseconds.

Here is how to use it:

```
cd evaluation
./coap_client help
./coap_client -i 192.0.2.3 -n 10000
cat out.txt
```

You might run this evaluation with the patch enabled or not.

Have fun!


